<% if @jampost.user == current_user && current_user %>
  <%= link_to "Edit", edit_jampost_path(@jampost), class:'homebutton'%>
<% end %>

<h1 class="showtitle"><%= @jampost.title %></h1>

<%= image_tag @jampost.img_url %>
<p><span class='showinfo'>Location: </span><%= @jampost.location %></p>
<p><span class='showinfo'>Time: </span><%= @jampost.time %></p>
<p><span class='showinfo'>About: </span><%= @jampost.body %></p>

<% if @jampost.is_drumcircle%>
  <p><span class='showinfo'>Current Members: </span> <%= @jampost.current_members %></p>
<% end %>

<% if @jampost.is_drumcircle && @jampost.size_limit %>
  <p><span class='showinfo'>Size Limit: </span> <%= @jampost.size_limit %> People</p>
  <%= form_for @jampost, method: :put do |f| %>
    <%= f.submit "Join!" %>
  <% end %>
<% end %>

<% if !@jampost.is_drumcircle && @jampost.user == current_user && current_user%>
  <h2 class='bandtitle'> Your Current Band is: </h2>
    <br>
    <div class = 'bandbox'>
    <% @jampost.instruments.each do |inst| %>
      <div class ='instrument'><%= inst.instrument %></div>
      <%= form_for [@jampost, inst], method: :delete do |f| %>
        <%= f.submit "remove", class: "removebutton" %>
        <span>,&nbsp;&nbsp;</span>
      <% end %>
    <% end %>
  </div>
  <%= simple_form_for [@jampost, @instrument] do |f| %>
    <p>
      <%= f.input :instrument, label: 'Instruments:', collection: ['bass','drums','keyboard','percussion','vocals','guitar','cowbell','saxophone','trumpet'], prompt: 'Please select!', :class => 'showinfo' %>
    </p>
    <p>
      <%= f.submit 'ADD', class: 'button', method: :create  %>
    </p>
  <% end %>
  <% elsif !(@jampost.is_drumcircle) && @jampost.user != current_user || !current_user && !(@jampost.is_drumcircle) %>
    <h2> Here are the instruments still available: </h2>
    <div class = 'bandbox'>
    <% @jampost.instruments.each do |inst| %>
      <% if !inst.user %>
        <div class ='instrument'>
          <%= inst.instrument %>
        </div>
      <%
      # Wrapping the form button in an if statement allows you
      # prevent displaying the button if the user already selected
      # an instrument on this jam.
      # See: app/controllers/jamposts_controller.rb
      #
      # My suggestion here is an incomplete solution, though. Imagine if the user
      # had opened up the jam page in multiple tabs, they'd have extra copies of
      # the page and buttons which they could still use (accidentally or otherwise)
      # to sign up for the remaining instruments.
      #
      # More work would be needed in the jamposts controller to prevent extra
      # instrument sign ups from being accepted.
      if !@already_chose_an_instrument %>
        <%= form_for [@jampost, inst], method: :put do |f| %>
          <%= f.submit "sign up!" %><span>,</span>
        <% end %>
      <% end %>
      <% else %>
      <%
      # Here using two css classes for your taken instrument, allows you to keep all of
      # the existing style from `.instrment`, and add an extra class just for the
      # modifications when marking as taken
      %>
      <div class ='taken instrument'>
        <%= inst.instrument %>
      </div>
      <%
      # A way to release their chosen instrument might be useful if
      # the musician changes their mind.
      # See: app/controllers/instruments_controller.rb for changes there
      %>
        <%= form_for [@jampost, inst], method: :put do |f| %>
          <%= f.hidden_field :release, :value => true %>
          <%= f.submit "Release #{inst.instrument}" %><span>,</span>
        <% end %>
      <% end %>
    <% end %>
    </div>
<% end %>
<hr>
<% if @jampost.comments.length > 0 %>
  <h2 class = 'commentstitle'>Comments</h2>
  <% @jampost.comments.each do |comment| %>
    <p class='commentbody'>
      <%= comment.body %>
    </p>
    <p class='commentinfo' >
      <%= comment.created_at %>
    </p>
    <br>
  <% if comment.user == current_user && current_user %>
    <%= link_to "Edit", edit_jampost_comment_path(@jampost, comment),class:'homebutton' %>
  <% end %>
  <% end %>
  <hr class='shorthr'>
<% end %>


<%= simple_form_for [@jampost, @comment], :html=> {class: 'signuplink'} do |f| %>
<p>
  <%= f.input :body, label: "Comment: " %>
</p>
<p>
  <%= f.submit "Add comment" , class: 'button' %>
</p>
<% end %>
